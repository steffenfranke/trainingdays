<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Messaging | Azure Developer College</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/trainingdays/assets/css/0.styles.55d7defa.css" as="style"><link rel="preload" href="/trainingdays/assets/js/app.4e41fb3a.js" as="script"><link rel="preload" href="/trainingdays/assets/js/2.5c48a4b9.js" as="script"><link rel="preload" href="/trainingdays/assets/js/22.9b0a1980.js" as="script"><link rel="prefetch" href="/trainingdays/assets/js/10.aef72863.js"><link rel="prefetch" href="/trainingdays/assets/js/11.dd60f0cc.js"><link rel="prefetch" href="/trainingdays/assets/js/12.ae79c35b.js"><link rel="prefetch" href="/trainingdays/assets/js/13.d7362d79.js"><link rel="prefetch" href="/trainingdays/assets/js/14.c6d2211c.js"><link rel="prefetch" href="/trainingdays/assets/js/15.89019d4a.js"><link rel="prefetch" href="/trainingdays/assets/js/16.dd2ba348.js"><link rel="prefetch" href="/trainingdays/assets/js/17.8567513c.js"><link rel="prefetch" href="/trainingdays/assets/js/18.8ccb6e07.js"><link rel="prefetch" href="/trainingdays/assets/js/19.23df6ec5.js"><link rel="prefetch" href="/trainingdays/assets/js/20.3f5af8e5.js"><link rel="prefetch" href="/trainingdays/assets/js/21.bd49efc0.js"><link rel="prefetch" href="/trainingdays/assets/js/23.26cfda68.js"><link rel="prefetch" href="/trainingdays/assets/js/24.348d8bcd.js"><link rel="prefetch" href="/trainingdays/assets/js/25.73968882.js"><link rel="prefetch" href="/trainingdays/assets/js/26.acb12c33.js"><link rel="prefetch" href="/trainingdays/assets/js/27.da734a7a.js"><link rel="prefetch" href="/trainingdays/assets/js/28.2965a280.js"><link rel="prefetch" href="/trainingdays/assets/js/29.3efd14d4.js"><link rel="prefetch" href="/trainingdays/assets/js/3.7853f01c.js"><link rel="prefetch" href="/trainingdays/assets/js/30.8e1ba2e5.js"><link rel="prefetch" href="/trainingdays/assets/js/31.052c41ce.js"><link rel="prefetch" href="/trainingdays/assets/js/32.bb4f0866.js"><link rel="prefetch" href="/trainingdays/assets/js/33.ebc4456e.js"><link rel="prefetch" href="/trainingdays/assets/js/34.d4f4cd67.js"><link rel="prefetch" href="/trainingdays/assets/js/35.91396271.js"><link rel="prefetch" href="/trainingdays/assets/js/36.68553783.js"><link rel="prefetch" href="/trainingdays/assets/js/37.6dc1c77d.js"><link rel="prefetch" href="/trainingdays/assets/js/38.3bdd31f8.js"><link rel="prefetch" href="/trainingdays/assets/js/39.6327f945.js"><link rel="prefetch" href="/trainingdays/assets/js/4.d0c35bab.js"><link rel="prefetch" href="/trainingdays/assets/js/40.bcaa6e7e.js"><link rel="prefetch" href="/trainingdays/assets/js/41.c9042a74.js"><link rel="prefetch" href="/trainingdays/assets/js/42.a563101c.js"><link rel="prefetch" href="/trainingdays/assets/js/43.9de59cb1.js"><link rel="prefetch" href="/trainingdays/assets/js/44.4606b412.js"><link rel="prefetch" href="/trainingdays/assets/js/45.abe9e469.js"><link rel="prefetch" href="/trainingdays/assets/js/46.c818587d.js"><link rel="prefetch" href="/trainingdays/assets/js/47.78755f73.js"><link rel="prefetch" href="/trainingdays/assets/js/48.4b8294f3.js"><link rel="prefetch" href="/trainingdays/assets/js/49.46931401.js"><link rel="prefetch" href="/trainingdays/assets/js/5.3e2883cc.js"><link rel="prefetch" href="/trainingdays/assets/js/50.cd82fedd.js"><link rel="prefetch" href="/trainingdays/assets/js/51.b8e1d3e0.js"><link rel="prefetch" href="/trainingdays/assets/js/52.259b94a8.js"><link rel="prefetch" href="/trainingdays/assets/js/53.d2b23810.js"><link rel="prefetch" href="/trainingdays/assets/js/54.a46c4953.js"><link rel="prefetch" href="/trainingdays/assets/js/55.595bb902.js"><link rel="prefetch" href="/trainingdays/assets/js/56.1c8ea017.js"><link rel="prefetch" href="/trainingdays/assets/js/57.f2d11948.js"><link rel="prefetch" href="/trainingdays/assets/js/58.1efc6d42.js"><link rel="prefetch" href="/trainingdays/assets/js/59.10296053.js"><link rel="prefetch" href="/trainingdays/assets/js/6.e5234229.js"><link rel="prefetch" href="/trainingdays/assets/js/60.24d77311.js"><link rel="prefetch" href="/trainingdays/assets/js/61.049c07c2.js"><link rel="prefetch" href="/trainingdays/assets/js/62.72c5ecf6.js"><link rel="prefetch" href="/trainingdays/assets/js/63.214f8165.js"><link rel="prefetch" href="/trainingdays/assets/js/64.fae879e9.js"><link rel="prefetch" href="/trainingdays/assets/js/65.043d8ee1.js"><link rel="prefetch" href="/trainingdays/assets/js/66.2db76ce6.js"><link rel="prefetch" href="/trainingdays/assets/js/67.1319f6b5.js"><link rel="prefetch" href="/trainingdays/assets/js/68.8cd5f060.js"><link rel="prefetch" href="/trainingdays/assets/js/69.9bd4a024.js"><link rel="prefetch" href="/trainingdays/assets/js/7.8252e178.js"><link rel="prefetch" href="/trainingdays/assets/js/70.2a64a900.js"><link rel="prefetch" href="/trainingdays/assets/js/71.959f20c1.js"><link rel="prefetch" href="/trainingdays/assets/js/72.358fc61d.js"><link rel="prefetch" href="/trainingdays/assets/js/73.0d2d6a52.js"><link rel="prefetch" href="/trainingdays/assets/js/74.40ff9eda.js"><link rel="prefetch" href="/trainingdays/assets/js/75.219db2db.js"><link rel="prefetch" href="/trainingdays/assets/js/76.866125a0.js"><link rel="prefetch" href="/trainingdays/assets/js/77.2ed2da6a.js"><link rel="prefetch" href="/trainingdays/assets/js/78.f401cfc2.js"><link rel="prefetch" href="/trainingdays/assets/js/79.de315c3e.js"><link rel="prefetch" href="/trainingdays/assets/js/8.a3d1de90.js"><link rel="prefetch" href="/trainingdays/assets/js/80.b15d8099.js"><link rel="prefetch" href="/trainingdays/assets/js/9.d27e6b51.js">
    <link rel="stylesheet" href="/trainingdays/assets/css/0.styles.55d7defa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/trainingdays/" class="home-link router-link-active"><!----> <span class="site-name">Azure Developer College</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/trainingdays/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/trainingdays/day1/" class="sidebar-link">Day 1 Azure Fundamentals &amp; Infrastructure</a></li><li><a href="/trainingdays/day2/" aria-current="page" class="sidebar-link">Day 2 Azure Development</a></li><li><a href="/trainingdays/day3/" class="sidebar-link">Day 3 Data and AI</a></li><li><a href="/trainingdays/day4/" class="sidebar-link">Day 4 Azure DevOps</a></li><li><a href="/trainingdays/day5/" class="sidebar-link">Day 5 Identity and Architecture</a></li><li><a href="/trainingdays/day6/" class="sidebar-link">Day 6 Containerization</a></li><li><a href="/trainingdays/day7/" class="sidebar-link">Day 7 Kubernetes</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="messaging"><a href="#messaging" class="header-anchor">#</a> Messaging</h1> <p>In this chapter, you will get to know Azure messaging offerings to loosely connect services with each other. You will use <em>Azure Service Bus Topics</em> as an example. <em>Azure Storage Queues</em> will be used in the next Break Out session, our SCM Contacts application.</p> <h2 id="here-is-what-you-will-learn"><a href="#here-is-what-you-will-learn" class="header-anchor">#</a> Here is what you will learn</h2> <ul><li>Use Azure Service Bus for pub/sub scenarios (Consumer/Producer pattern)</li> <li>Use Azure Logic Apps to subscribe to topics and process them</li></ul> <h2 id="azure-service-bus-publish-subscriber-pattern"><a href="#azure-service-bus-publish-subscriber-pattern" class="header-anchor">#</a> Azure Service Bus Publish / Subscriber Pattern</h2> <h3 id="create-an-azure-service-bus-namespace"><a href="#create-an-azure-service-bus-namespace" class="header-anchor">#</a> Create an Azure Service Bus Namespace</h3> <p>To begin to use Azure Service Bus, you first need to create a namespace with a globally unique name. As done before with other services, create a resource group, e.g. <em>messaging-rg</em>, in West Europe and click on &quot;Create Resource&quot;. Search for &quot;Service Bus&quot; and click on &quot;Create&quot;.</p> <p>Now fill out the form, giving your Service Bus a unique name and choosing the Pricing Tier <strong>Standard</strong>.</p> <p>When the Service Bus is created, open it in the Portal and add a new Topic:</p> <p><img src="/trainingdays/assets/img/portal_sb_topic.5d0057c5.png" alt="portal_sb_topic" title="portal_sb_topic"></p> <p>Give the <strong>Topic</strong> a name, e.g. <em>message</em> and leave the other parameters as proposed by Azure.</p> <p>When the topic has been created, open it in the portal and create a <strong>Subscription</strong> via the menu bar. Give it a name, e.g. <em>testsubscription</em>, set the &quot;Max delivery count&quot; to <code>10</code> (--&gt; how often should Azure try to deliver a message?) and leave all other parameters as proposed by the portal.</p> <p>When the <strong>Topic</strong> and the <strong>Subscription</strong> have been created, we need to copy the <strong>Connection String</strong> to our Service Bus. Therefore, got to &quot;Shared Access Policy&quot;, &quot;RootManagedSharedAccessKey&quot; (of the Service Bus, not the topic!) and copy/note down the <strong>Primary Connection String</strong>.</p> <h3 id="add-a-producer"><a href="#add-a-producer" class="header-anchor">#</a> Add a Producer</h3> <p>Now open Visual Studio Code and open the folder <strong>day2/challenges/sbtester</strong>. There, you will find a sample application that is able to send messages to a Service Bus Topic, like the one we have just created.</p> <p>Open <em>Program.cs</em> and enter the connection string and the topic name to the predefined variables.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> ServiceBusConnectionString <span class="token operator">=</span> <span class="token string">&quot;&lt;your_connection_string&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> TopicName <span class="token operator">=</span> <span class="token string">&quot;&lt;your_topic_name&gt;&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>Make yourself familiar with the code and examine, how messages are created and sent to Azure Service Bus. If you are done with that, run the sample application.</p> <p>Open a terminal in the folder <em>day2/challenges/sbtester</em> and execute:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ dotnet build <span class="token operator">&amp;&amp;</span> dotnet run
Microsoft <span class="token punctuation">(</span>R<span class="token punctuation">)</span> Build Engine version <span class="token number">16.4</span>.0+e901037fe <span class="token keyword">for</span> .NET Core
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> Microsoft Corporation. All rights reserved.

  Restore completed <span class="token keyword">in</span> <span class="token number">32.32</span> ms <span class="token keyword">for</span> /Users/christiandennig/dev/azure-developer-college/day2/challenges/sbtester/sbtester.csproj.
  sbtester -<span class="token operator">&gt;</span> /Users/christiandennig/dev/azure-developer-college/day2/challenges/sbtester/bin/Debug/netcoreapp3.1/sbtester.dll

Build succeeded.
    <span class="token number">0</span> Warning<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token number">0</span> Error<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

Time Elapsed 00:00:01.29
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Press ENTER key to <span class="token builtin class-name">exit</span> after sending all the messages.
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Sending message: Message d31e0280-d300-4a91-8b98-c84b0746040a
Sending message: Message 76ef548c-9483-439e-8b1f-ee9c1580dc50
Sending message: Message 383b103b-ab00-4162-ae8c-9ad6dc67669e
Sending message: Message e855bbc0-e74c-4739-ba65-33754d5aedce
Sending message: Message 424f5f20-074c-45a4-9f67-97c7cf43d027
Sending message: Message 76b35c84-1fe0-48f7-a82c-a279db2e0fec
Sending message: Message 25ece212-5a4c-45e1-a04d-bc3ac07a9058
Sending message: Message 8f0feabe-40fc-405b-a46d-8a6901805152
Sending message: Message e9f1ca91-82c5-40db-ad3f-e5f483424556
Sending message: Message d61b256c-5c8c-482c-904a-63d322003c70
</code></pre></div><p>Congratulations! You have just sent your first 10 messages to an Azure Service Bus Topic. Check that the messages have arrived in the subscription queue.</p> <p><img src="/trainingdays/assets/img/portal_sb_messages.d75707e7.png" alt="portal_sb_messages" title="portal_sb_messages"></p> <p>So, now let's create the subscriber that picks up the messages and does some kind of processing with each message. We could use another console application, but that's more than boring! We will use an Azure Logic App...<em>Serverless Resprise</em>, so to say!</p> <h3 id="add-a-consumer"><a href="#add-a-consumer" class="header-anchor">#</a> Add a Consumer</h3> <p>In the Portal create a new Azure Logic App. As usual via &quot;Create a resource&quot;, give it a unique name, use the same resource group as for the Service Bus (<em>messaging-rg</em>) and put it in &quot;West Europe&quot;.</p> <p>When the Logic App has been deployed, open it in the Portal and in the <em>Templates</em> section, click on &quot;Blank logic App&quot;. In the search box, search for &quot;service bus topic&quot; and choose &quot;When a message is received in a topic subscription (auto-complete).</p> <p><img src="/trainingdays/assets/img/portal_la_topic.caa62bc8.png" alt="portal_la_topic" title="portal_la_topic"></p> <p>Now give the connection a name and choose the Service Bus you created in the previous chapter. When the connection to the Service Bus is established, you can specify the <em>Topic</em> and the <em>Subscription</em> to use. Your Logic App should now look like that:</p> <p><img src="/trainingdays/assets/img/portal_la_trigger.691dfd67.png" alt="portal_la_trigger" title="portal_la_trigger"></p> <p>You have just created the trigger connection between the Logic App and your Service Bus Topic/Subscription.</p> <p>Now, it's up to you what to do now with the messages, regarding the 200+ connectors we have in Azure Logic Apps! You can follow along with the sample that takes messages and creates blobs on a Storage Account.</p> <blockquote><p>...but you could also connect e.g. your O365 Mail or Gmail account and send a few messages to your colleagues next to you or add them to a database, a SAP System, Salesforce, use Azure Cognitive Services to analyze sentiment?! Imagine the possibilities 😃 So, be creative!</p></blockquote> <p>Here, we will follow the <em>boring path</em> and put the messages in a storage account blob container.</p> <blockquote><p>If you have already deleted the Storage Account from the previous challenge, go and create a new one and add a container! You now know, how this is can be done.</p></blockquote> <p>Back in the Logic App, you need to add a &quot;New Step&quot;, click on that button. In the search field, enter &quot;blob&quot; and select &quot;Create Blob&quot; from the suggested Actions. Enter a name for the connection and choose the appropriate Storage Account. Click &quot;Create&quot;.</p> <p>Configure the action:</p> <ul><li><p>choose the container to store the messages to (<em>Folder Path</em>).</p></li> <li><p>For the <em>blobname</em>, we simply let Azure create one for us. In the Expression tab, enter...<code>rand(100000,999999)</code> ...followed by &quot;.txt&quot;.</p></li> <li><p>For <em>Blob Content</em>, choose the predefined field &quot;Content&quot;. If that doesn't appear in the dropdown, switch to the Expression tab an enter <code>base64ToString(triggerBody()?['ContentData'])</code></p></li></ul> <blockquote><p>INFO: The message body is a base64 encoded string we must decode first.</p></blockquote> <p>The designer should now look like that:</p> <p><img src="/trainingdays/assets/img/portal_la_creatblob.9840af09.png" alt="portal_la_creatblob" title="portal_la_creatblob"></p> <p>Save the Logic App and click on the &quot;Run&quot; button in the command bar.</p> <p>Now got back to the <em>sbtester</em> app and run it again. A few seconds later, after the messages have been sent, you should see a successfully processed Service Bus message.</p> <p><img src="/trainingdays/assets/img/portal_la_sbsuccess.a08f3053.png" alt="portal_la_sbsuccess" title="portal_la_sbsuccess"></p> <p>Also check the Storage Explorer and have a look at the files that have been written.</p> <p><img src="/trainingdays/assets/img/storage_explorer_la.56d522ff.png" alt="storage_explorer_la" title="storage_explorer_la"></p> <h2 id="optional"><a href="#optional" class="header-anchor">#</a> Optional</h2> <p>You have seen how many connectors Azure Logic Apps has &quot;under the hood&quot;. Take the same scenario and adjust the messages to your needs (e.g. send JSON) and connect to another service, maybe one outside of Azure? (Gmail, Outlook, O365, SAP, Twitter...?!)</p> <p><strong>Happy Hacking!</strong> 😃</p> <h2 id="house-keeping"><a href="#house-keeping" class="header-anchor">#</a> House Keeping</h2> <p>Remove the sample resource group.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ az group delete -n messaging-rg
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azuredevcollege/trainingdays/edit/master/day2/challenges/challenge-3.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/trainingdays/assets/js/app.4e41fb3a.js" defer></script><script src="/trainingdays/assets/js/2.5c48a4b9.js" defer></script><script src="/trainingdays/assets/js/22.9b0a1980.js" defer></script>
  </body>
</html>
